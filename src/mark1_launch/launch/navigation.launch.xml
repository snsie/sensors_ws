<?xml version="1.0"?>
<launch>

  <!-- Arguments -->
  <arg name="use_sim_time" default="false"/>
  <arg name="params_file" default="/mnt/ssd/dev/sensors_ws/src/mark1_launch/config/nav2_params.yaml"/>

  <!-- Controller Server (publishes /cmd_vel) -->
  <node pkg="nav2_controller" exec="controller_server" name="controller_server" output="screen">
    <param from="$(var params_file)"/>
    <param name="use_sim_time" value="$(var use_sim_time)"/>
  </node>

  <!-- Planner Server (global planner) -->
  <node pkg="nav2_planner" exec="planner_server" name="planner_server" output="screen">
    <param from="$(var params_file)"/>
    <param name="use_sim_time" value="$(var use_sim_time)"/>
  </node>

  <!-- Smoother Server -->
  <node pkg="nav2_smoother" exec="smoother_server" name="smoother_server" output="screen">
    <param from="$(var params_file)"/>
    <param name="use_sim_time" value="$(var use_sim_time)"/>
  </node>

  <!-- Behavior Server (spin / backup / wait / assisted_teleop / drive_on_heading) -->
  <node pkg="nav2_behaviors" exec="behavior_server" name="behavior_server" output="screen">
    <param from="$(var params_file)"/>
    <param name="use_sim_time" value="$(var use_sim_time)"/>
  </node>

  <!-- BT Navigator -->
  <node pkg="nav2_bt_navigator" exec="bt_navigator" name="bt_navigator" output="screen">
    <param from="$(var params_file)"/>
    <param name="use_sim_time" value="$(var use_sim_time)"/>
    <!-- Optional: you can also set default_nav_to_pose_bt_xml via params_file if desired -->
  </node>

  <!-- Waypoint Follower -->
  <node pkg="nav2_waypoint_follower" exec="waypoint_follower" name="waypoint_follower" output="screen">
    <param from="$(var params_file)"/>
    <param name="use_sim_time" value="$(var use_sim_time)"/>
  </node>

  <!-- Velocity Smoother (filters /cmd_vel outbound) -->
  <node pkg="nav2_velocity_smoother" exec="velocity_smoother" name="velocity_smoother" output="screen">
    <param from="$(var params_file)"/>
    <param name="use_sim_time" value="$(var use_sim_time)"/>
  </node>

  <!-- Lifecycle Manager for navigation servers -->
  <node pkg="nav2_lifecycle_manager" exec="lifecycle_manager"
        name="lifecycle_manager_navigation" output="screen">
    <param from="$(var params_file)"/>
    <param name="use_sim_time" value="$(var use_sim_time)"/>
    <!-- Your params file already sets:
         autostart: true
         node_names: [controller_server, planner_server, smoother_server, behavior_server, bt_navigator, waypoint_follower, velocity_smoother]
    -->
  </node>

</launch>
